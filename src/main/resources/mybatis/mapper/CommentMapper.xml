<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intw.mentorapi.mapper.CommentMapper">

    <insert id="insertComment">
        INSERT INTO
               Comment (
               USER_IDX
             , BOARD_IDX
             , COMMENT
             , WRITE_IP
             , WRITE_AT
        )
        VALUES (
               #{userIdx}
             , #{boardIdx}
             , #{comment}
             , #{writeIp}
             , NOW()
               )
    </insert>

    <update id="updateComment">
        /* NOT_SQL_LOG */
        UPDATE Comment
           SET COMMENT = #{comment}
         WHERE IDX = #{idx}
           AND USER_IDX = #{userIdx}
           AND BOARD_IDX = #{boardIdx}
    </update>

    <delete id="deleteComment">
        /* NOT_SQL_LOG */
        DELETE FROM Comment
         WHERE IDX = #{idx}
           <if test='!role.equals("ROLE_ADMIN")'>
               AND USER_IDX = #{userIdx}
           </if>
    </delete>
</mapper>
